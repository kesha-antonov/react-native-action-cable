"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0});const consumer_1=__importDefault(require("./consumer")),internal_1=__importDefault(require("./internal")),ActionCable={INTERNAL:internal_1.default,WebSocket:"undefined"!=typeof window&&window.WebSocket?window.WebSocket:"undefined"!=typeof global&&global.WebSocket?global.WebSocket:globalThis.WebSocket,logger:"undefined"!=typeof window&&window.console?window.console:"undefined"!=typeof global&&global.console?global.console:console,debugging:!1,_consumers:{},createConsumer(e,o={}){return new consumer_1.default(e,this.log,this.WebSocket,o)},getOrCreateConsumer(e,o={}){var n;const t=this._createCacheKey(e,o);if(null===(n=this._consumers[t])||void 0===n?void 0:n.connection.isActive())return this.log("Reusing existing consumer for",e),this._consumers[t];this._consumers[t]&&!this._consumers[t].connection.isActive()&&(this.log("Cleaning up disconnected consumer for",e),this._consumers[t].disconnect(),delete this._consumers[t]),this.log("Creating new consumer for",e);const s=new consumer_1.default(e,this.log,this.WebSocket,o);return this._consumers[t]=s,s},disconnectConsumer(e,o={}){const n=this._createCacheKey(e,o);return!!this._consumers[n]&&(this._consumers[n].disconnect(),delete this._consumers[n],this.log("Disconnected consumer for",e),!0)},_createCacheKey:(e,o)=>`${"function"==typeof e?e():e}|${JSON.stringify("function"==typeof o?o():o)}`,startDebugging(){this.debugging=!0},stopDebugging(){this.debugging=null},log(...e){ActionCable.debugging&&(e.push(Date.now()),ActionCable.logger.log("[ActionCable]",...e))}};exports.default=ActionCable;