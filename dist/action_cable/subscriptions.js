"use strict";var __importDefault=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(exports,"__esModule",{value:!0});const subscription_1=__importDefault(require("./subscription"));class Subscriptions{constructor(t){this.subscriptions=[],this.create=t=>{const s="object"==typeof t?t:{channel:t},i=new subscription_1.default(this.consumer,s);return this.add(i)},this.add=t=>(this.subscriptions.push(t),this.consumer.ensureActiveConnection(),this.notify(t,"initialized"),this.sendCommand(t,"subscribe"),t),this.remove=t=>(this.forget(t),this.findAll(t.identifier).length||this.sendCommand(t,"unsubscribe"),t),this.reject=t=>{const s=this.findAll(t);for(const t of s)this.forget(t),this.notify(t,"rejected");return s},this.forget=t=>(this.subscriptions=this.subscriptions.filter((s=>s!==t)),t),this.findAll=t=>this.subscriptions.filter((s=>s.identifier===t)),this.reload=()=>{for(const t of this.subscriptions)this.sendCommand(t,"subscribe")},this.notifyAll=(t,...s)=>{for(const i of this.subscriptions)this.notify(i,t,...s)},this.notify=(t,s,...i)=>{let e;e="string"==typeof t?this.findAll(t):[t];for(const t of e)"function"==typeof t[s]&&t[s](...i)},this.sendCommand=(t,s)=>{const{identifier:i}=t;this.consumer.send({command:s,identifier:i})},this.consumer=t}}exports.default=Subscriptions;